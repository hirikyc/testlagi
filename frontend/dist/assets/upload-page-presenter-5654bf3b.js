class w{constructor(){this.imageData=null}setImageData(n){this.imageData=n}getImageData(){return this.imageData}}const B=w,E="http://localhost:8000/detect",D={async predictFood(r){const n=new FormData;n.append("file",r);const s=await fetch(E,{method:"POST",body:n});if(!s.ok)throw new Error("Gagal memproses gambar");return await s.json()}};function $(){const r=new B,n=document.getElementById("video"),s=document.getElementById("canvas"),c=document.getElementById("preview"),d=document.getElementById("fileInput"),p=document.getElementById("capture"),f=document.getElementById("startCamera"),b=document.getElementById("allowCamera"),h=document.getElementById("cameraMode"),y=document.getElementById("permissionPrompt"),i=document.getElementById("drop-area"),o=document.getElementById("prediction-result"),l=document.getElementById("analyzeBtn");let m,g=null;y&&(y.style.display="block"),b&&(b.onclick=async()=>{y.style.display="none";try{(await navigator.permissions.query({name:"camera"})).state==="denied"&&alert("Akses kamera ditolak. Silakan izinkan dari pengaturan browser.")}catch{}alert("Kamera siap digunakan. Silakan klik tombol 'Buka Kamera'.")}),f&&(f.onclick=async()=>{const e=h.value;try{m=await navigator.mediaDevices.getUserMedia({video:{facingMode:e},audio:!1}),n.srcObject=m,n.style.display="block",p.style.display="inline-block"}catch(t){alert("Gagal membuka kamera: "+t.message)}});async function v(e){const t=new FileReader;t.onload=()=>{r.setImageData(t.result),c.src=t.result,c.style.display="block",l&&(l.style.display="inline-block")},t.readAsDataURL(e),g=e,o.textContent=""}l&&(l.onclick=async()=>{if(!g){o.textContent="Silakan pilih atau ambil gambar terlebih dahulu.";return}o.innerHTML='<span class="prediksi-title">Memprediksi...</span>';try{const e=await D.predictFood(g);if(e.detection){const t=e.detection,k=(t.top_predictions||[]).map((a,I)=>`<div class="prediksi-top">${I===0?"<b>Top 3 Prediksi:</b><br>":""}<span class="prediksi-food">${a.food_name}</span> <span class="prediksi-confidence">(${(a.confidence*100).toFixed(1)}%)</span> <span class="prediksi-origin">Asal: ${a.origin}</span></div>`).join("");let u="";e.recommendations&&e.recommendations.length>0&&(u='<div class="prediksi-rekomendasi"><span class="prediksi-rekomendasi-title">Rekomendasi Restoran:</span><ul class="prediksi-rekomendasi-list">'+e.recommendations.map(a=>`<li><b>${a.name}</b> <span style='color:#ffb800'>&#9733;${a.rating}</span> <span style='color:#666'>(Lokasi: ${a.cuisine}, Skor: ${(a.similarity_score*100).toFixed(1)}%)</span></li>`).join("")+"</ul></div>"),o.innerHTML=`
          <span class="prediksi-title">Prediksi Makanan</span>
          <span class="prediksi-food">${t.food_name}</span>
          <span class="prediksi-origin">Asal: ${t.origin}</span>
          <span class="prediksi-confidence">Kepercayaan: ${(t.confidence*100).toFixed(1)}%</span>
          ${k}
          ${u}
        `}else o.textContent=JSON.stringify(e)}catch(e){o.textContent="Gagal memproses gambar: "+e.message}}),p&&(p.onclick=async()=>{s.style.display="block",s.getContext("2d").drawImage(n,0,0,s.width,s.height);const t=s.toDataURL("image/png");r.setImageData(t),c.src=t,c.style.display="block",l&&(l.style.display="inline-block"),m&&m.getTracks().forEach(a=>a.stop()),n.style.display="none",p.style.display="none";const k=await(await fetch(t)).blob();g=new File([k],"capture.png",{type:"image/png"}),o.textContent=""}),d&&(d.onchange=e=>{const t=e.target.files[0];t&&v(t)}),i&&(i.addEventListener("dragover",e=>{e.preventDefault(),i.style.background="#f0f0f0"}),i.addEventListener("dragleave",e=>{e.preventDefault(),i.style.background=""}),i.addEventListener("drop",e=>{e.preventDefault(),i.style.background="";const t=e.dataTransfer.files[0];t&&v(t)}),i.addEventListener("click",()=>d&&d.click()))}export{$ as default};
